<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Book Management System - Project Report</title>
  <style>
    /* Default styles provided by pandoc.
    ** See https://pandoc.org/MANUAL.html#variables-for-html for config info.
    */
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@5/github-markdown.min.css" />
</head>
<body>
<header id="title-block-header">
<h1 class="title">Book Management System - Project Report</h1>
</header>
<nav id="TOC" role="doc-toc">
<ul>
<li><a href="#book-management-system---complete-project-report"
id="toc-book-management-system---complete-project-report">ğŸ“˜ Book
Management System - Complete Project Report</a>
<ul>
<li><a href="#executive-summary" id="toc-executive-summary">Executive
Summary</a></li>
<li><a href="#table-of-contents" id="toc-table-of-contents">Table of
Contents</a></li>
<li><a href="#project-overview" id="toc-project-overview">1. Project
Overview</a>
<ul>
<li><a href="#description" id="toc-description">1.1 Description</a></li>
<li><a href="#target-users" id="toc-target-users">1.2 Target
Users</a></li>
<li><a href="#key-statistics" id="toc-key-statistics">1.3 Key
Statistics</a></li>
</ul></li>
<li><a href="#system-architecture" id="toc-system-architecture">2.
System Architecture</a>
<ul>
<li><a href="#high-level-architecture-microservices"
id="toc-high-level-architecture-microservices">2.1 High-Level
Architecture (Microservices)</a></li>
<li><a href="#layered-architecture" id="toc-layered-architecture">2.2
Layered Architecture</a></li>
<li><a href="#aiml-integration" id="toc-aiml-integration">2.3 AI/ML
Integration</a></li>
</ul></li>
<li><a href="#technical-stack" id="toc-technical-stack">3. Technical
Stack</a>
<ul>
<li><a href="#core-technologies" id="toc-core-technologies">3.1 Core
Technologies</a></li>
<li><a href="#aiml-stack" id="toc-aiml-stack">3.2 AI/ML Stack</a></li>
<li><a href="#security-authentication"
id="toc-security-authentication">3.3 Security &amp;
Authentication</a></li>
<li><a href="#devops-testing" id="toc-devops-testing">3.4 DevOps &amp;
Testing</a></li>
<li><a href="#development-tools" id="toc-development-tools">3.5
Development Tools</a></li>
</ul></li>
<li><a href="#core-features" id="toc-core-features">4. Core Features</a>
<ul>
<li><a href="#user-management" id="toc-user-management">4.1 User
Management</a></li>
<li><a href="#book-management" id="toc-book-management">4.2 Book
Management</a></li>
<li><a href="#borrowing-system" id="toc-borrowing-system">4.3 Borrowing
System</a></li>
<li><a href="#review-rating-system" id="toc-review-rating-system">4.4
Review &amp; Rating System</a></li>
</ul></li>
<li><a href="#aiml-capabilities" id="toc-aiml-capabilities">5. AI/ML
Capabilities</a>
<ul>
<li><a href="#ai-powered-book-recommendations"
id="toc-ai-powered-book-recommendations">5.1 AI-Powered Book
Recommendations</a></li>
<li><a href="#natural-language-search"
id="toc-natural-language-search">5.2 Natural Language Search</a></li>
<li><a
href="#rag-retrieval-augmented-generation---microservice-architecture"
id="toc-rag-retrieval-augmented-generation---microservice-architecture">5.3
RAG (Retrieval-Augmented Generation) - Microservice
Architecture</a></li>
</ul></li>
<li><a href="#database-design" id="toc-database-design">6. Database
Design</a>
<ul>
<li><a href="#entity-relationship-diagram"
id="toc-entity-relationship-diagram">6.1 Entity Relationship
Diagram</a></li>
<li><a href="#table-specifications" id="toc-table-specifications">6.2
Table Specifications</a></li>
<li><a href="#database-features" id="toc-database-features">6.3 Database
Features</a></li>
</ul></li>
<li><a href="#api-documentation" id="toc-api-documentation">7. API
Documentation</a>
<ul>
<li><a href="#authentication-endpoints"
id="toc-authentication-endpoints">7.1 Authentication Endpoints</a></li>
<li><a href="#book-endpoints" id="toc-book-endpoints">7.2 Book
Endpoints</a></li>
<li><a href="#borrowing-endpoints" id="toc-borrowing-endpoints">7.3
Borrowing Endpoints</a></li>
<li><a href="#review-endpoints" id="toc-review-endpoints">7.4 Review
Endpoints</a></li>
<li><a href="#ai-endpoints" id="toc-ai-endpoints">7.5 AI
Endpoints</a></li>
<li><a href="#rag-endpoints" id="toc-rag-endpoints">7.6 RAG
Endpoints</a></li>
<li><a href="#interactive-api-documentation"
id="toc-interactive-api-documentation">7.7 Interactive API
Documentation</a></li>
</ul></li>
<li><a href="#security-authentication-1"
id="toc-security-authentication-1">8. Security &amp; Authentication</a>
<ul>
<li><a href="#jwt-token-system" id="toc-jwt-token-system">8.1 JWT Token
System</a></li>
<li><a href="#role-based-access-control-rbac"
id="toc-role-based-access-control-rbac">8.2 Role-Based Access Control
(RBAC)</a></li>
<li><a href="#security-measures" id="toc-security-measures">8.3 Security
Measures</a></li>
</ul></li>
<li><a href="#testing-quality-assurance"
id="toc-testing-quality-assurance">9. Testing &amp; Quality
Assurance</a>
<ul>
<li><a href="#test-structure" id="toc-test-structure">9.1 Test
Structure</a></li>
<li><a href="#testing-tools" id="toc-testing-tools">9.2 Testing
Tools</a></li>
<li><a href="#test-coverage" id="toc-test-coverage">9.3 Test
Coverage</a></li>
</ul></li>
<li><a href="#deployment" id="toc-deployment">10. Deployment</a>
<ul>
<li><a href="#docker-deployment" id="toc-docker-deployment">10.1 Docker
Deployment</a></li>
<li><a href="#environment-variables" id="toc-environment-variables">10.2
Environment Variables</a></li>
<li><a href="#production-deployment-render.com"
id="toc-production-deployment-render.com">10.3 Production Deployment
(Render.com)</a></li>
</ul></li>
<li><a href="#performance-optimizations"
id="toc-performance-optimizations">11. Performance Optimizations</a>
<ul>
<li><a href="#database-optimizations"
id="toc-database-optimizations">11.1 Database Optimizations</a></li>
<li><a href="#application-optimizations"
id="toc-application-optimizations">11.2 Application
Optimizations</a></li>
<li><a href="#ai-performance" id="toc-ai-performance">11.3 AI
Performance</a></li>
</ul></li>
<li><a href="#project-structure" id="toc-project-structure">12. Project
Structure</a>
<ul>
<li><a href="#directory-tree" id="toc-directory-tree">12.1 Directory
Tree</a></li>
<li><a href="#code-statistics" id="toc-code-statistics">12.2 Code
Statistics</a></li>
</ul></li>
<li><a href="#key-innovations" id="toc-key-innovations">13. Key
Innovations</a>
<ul>
<li><a href="#dual-search-strategy" id="toc-dual-search-strategy">13.1
Dual Search Strategy</a></li>
<li><a href="#fuzzy-matching-system" id="toc-fuzzy-matching-system">13.2
Fuzzy Matching System</a></li>
<li><a href="#rag-with-access-control"
id="toc-rag-with-access-control">13.3 RAG with Access Control</a></li>
</ul></li>
<li><a href="#future-enhancements" id="toc-future-enhancements">14.
Future Enhancements</a>
<ul>
<li><a href="#planned-features" id="toc-planned-features">14.1 Planned
Features</a></li>
<li><a href="#performance-improvements"
id="toc-performance-improvements">14.2 Performance Improvements</a></li>
</ul></li>
<li><a href="#conclusion" id="toc-conclusion">15. Conclusion</a>
<ul>
<li><a href="#project-achievements" id="toc-project-achievements">15.1
Project Achievements</a></li>
<li><a href="#technology-highlights" id="toc-technology-highlights">15.2
Technology Highlights</a></li>
<li><a href="#business-value" id="toc-business-value">15.3 Business
Value</a></li>
</ul></li>
<li><a href="#appendix-a-quick-start-commands"
id="toc-appendix-a-quick-start-commands">Appendix A: Quick Start
Commands</a></li>
<li><a href="#appendix-b-contact-support"
id="toc-appendix-b-contact-support">Appendix B: Contact &amp;
Support</a></li>
</ul></li>
</ul>
</nav>
<h1 id="book-management-system---complete-project-report">ğŸ“˜ Book
Management System - Complete Project Report</h1>
<h2 id="executive-summary">Executive Summary</h2>
<p><strong>Project Name:</strong> Book Management API<br />
<strong>Version:</strong> 1.0.0<br />
<strong>Technology:</strong> FastAPI + PostgreSQL + AI/ML<br />
<strong>Repository:</strong> hiren0158/book-management-api<br />
<strong>Status:</strong> Production Ready âœ…</p>
<hr />
<h2 id="table-of-contents">Table of Contents</h2>
<ol type="1">
<li><a href="#1-project-overview">Project Overview</a></li>
<li><a href="#2-system-architecture">System Architecture</a></li>
<li><a href="#3-technical-stack">Technical Stack</a></li>
<li><a href="#4-core-features">Core Features</a></li>
<li><a href="#5-aiml-capabilities">AI/ML Capabilities</a></li>
<li><a href="#6-database-design">Database Design</a></li>
<li><a href="#7-api-documentation">API Documentation</a></li>
<li><a href="#8-security--authentication">Security &amp;
Authentication</a></li>
<li><a href="#9-testing--quality-assurance">Testing &amp; Quality
Assurance</a></li>
<li><a href="#10-deployment">Deployment</a></li>
<li><a href="#11-performance-optimizations">Performance
Optimizations</a></li>
<li><a href="#12-project-structure">Project Structure</a></li>
</ol>
<hr />
<h2 id="project-overview">1. Project Overview</h2>
<h3 id="description">1.1 Description</h3>
<p>A modern, production-ready RESTful API for managing a <strong>book
library system</strong> with advanced features including: - User
authentication &amp; role-based access control (RBAC) - Book catalog
management with full CRUD operations - Borrowing and returns tracking -
Review and rating system - <strong>AI-powered recommendations</strong>
using Gemini AI - <strong>Natural language search</strong> with
intelligent query parsing - <strong>RAG (Retrieval-Augmented
Generation)</strong> for document Q&amp;A</p>
<h3 id="target-users">1.2 Target Users</h3>
<ul>
<li><strong>Library Administrators</strong> - Full system
management</li>
<li><strong>Librarians</strong> - Book &amp; borrowing management</li>
<li><strong>Members</strong> - Browse, borrow, review books</li>
</ul>
<h3 id="key-statistics">1.3 Key Statistics</h3>
<table>
<thead>
<tr>
<th>Metric</th>
<th>Count</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>API Endpoints</strong></td>
<td>30+</td>
</tr>
<tr>
<td><strong>Database Tables</strong></td>
<td>6</td>
</tr>
<tr>
<td><strong>AI Features</strong></td>
<td>3 (Recommendations, NL Search, RAG)</td>
</tr>
<tr>
<td><strong>Test Cases</strong></td>
<td>200+ (Unit &amp; Integration)</td>
</tr>
<tr>
<td><strong>Dependencies</strong></td>
<td>20+ production packages</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="system-architecture">2. System Architecture</h2>
<h3 id="high-level-architecture-microservices">2.1 High-Level
Architecture (Microservices)</h3>
<pre class="mermaid"><code>graph TB
    Client[Client Applications] --&gt; MainApp[FastAPI Main App&lt;br/&gt;Render.com]
    
    MainApp --&gt; Auth[Authentication Layer]
    MainApp --&gt; RBAC[RBAC Middleware]
    
    Auth --&gt; JWT[JWT Token Service]
    RBAC --&gt; Deps[Dependencies Layer]
    
    MainApp --&gt; Routes[API Routes]
    Routes --&gt; Services[Business Logic Layer]
    Services --&gt; Repos[Repository Layer]
    Repos --&gt; DB[(PostgreSQL Database)]
    
    Services --&gt; AITools[AI Tools Layer]
    AITools --&gt; Gemini[Gemini AI API]
    
    Services --&gt; RAGClient[RAG HTTP Client]
    RAGClient --&gt;|HTTPS + API Key| RAGService[RAG Microservice&lt;br/&gt;HuggingFace Spaces]
    
    RAGService --&gt; PDFParser[PDF Processing]
    RAGService --&gt; VectorDB[ChromaDB Vector Store]
    RAGService --&gt; Embeddings[Sentence Transformers]
    RAGService --&gt; GeminiRAG[Gemini AI]
    
    style MainApp fill:#4CAF50
    style DB fill:#2196F3
    style Gemini fill:#FF9800
    style RAGService fill:#9C27B0
    style VectorDB fill:#673AB7</code></pre>
<h3 id="layered-architecture">2.2 Layered Architecture</h3>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    API Layer (FastAPI)                   â”‚
â”‚  Endpoints: auth, books, borrowings, reviews, AI, RAG   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Service Layer (Business Logic)              â”‚
â”‚  AuthService, BookService, BorrowingService, AIService  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Repository Layer (Data Access)                â”‚
â”‚  UserRepo, BookRepo, BorrowingRepo, ReviewRepo          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Database Layer (PostgreSQL)                 â”‚
â”‚  Users, Books, Borrowings, Reviews, Roles, RAG Docs     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>
<h3 id="aiml-integration">2.3 AI/ML Integration</h3>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          MAIN APP (Render) - AI Services                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  1. Book Recommendations (Gemini AI)                         â”‚
â”‚     â€¢ Analyzes user history                                  â”‚
â”‚     â€¢ Genre matching with relationships                      â”‚
â”‚     â€¢ Personalized suggestions                               â”‚
â”‚                                                               â”‚
â”‚  2. Natural Language Search (Gemini AI)                      â”‚
â”‚     â€¢ SQL WHERE clause generation                            â”‚
â”‚     â€¢ Filter extraction with fuzzy matching                  â”‚
â”‚     â€¢ Security validation (SQL injection prevention)         â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
                      HTTP API Connection
                      (API Key Authentication)
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    RAG MICROSERVICE (HuggingFace Spaces) - Document Q&amp;A     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  3. RAG Document Q&amp;A System                                  â”‚
â”‚     â€¢ PDF text extraction (PyMuPDF)                         â”‚
â”‚     â€¢ Text chunking (1200 chars, 200 overlap)               â”‚
â”‚     â€¢ Vector embeddings (Sentence Transformers)              â”‚
â”‚     â€¢ Semantic search (ChromaDB)                             â”‚
â”‚     â€¢ Context-aware answers (Gemini AI)                      â”‚
â”‚     â€¢ API: /upload, /ask, /documents/{id}                    â”‚
â”‚     â€¢ Authentication: X-API-Key header                       â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>
<hr />
<h2 id="technical-stack">3. Technical Stack</h2>
<h3 id="core-technologies">3.1 Core Technologies</h3>
<table>
<thead>
<tr>
<th>Category</th>
<th>Technology</th>
<th>Version</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Framework</strong></td>
<td>FastAPI</td>
<td>0.122.0</td>
<td>Web framework</td>
</tr>
<tr>
<td><strong>Language</strong></td>
<td>Python</td>
<td>3.11+</td>
<td>Programming language</td>
</tr>
<tr>
<td><strong>Database</strong></td>
<td>PostgreSQL</td>
<td>15+</td>
<td>Relational database</td>
</tr>
<tr>
<td><strong>ORM</strong></td>
<td>SQLModel</td>
<td>0.0.27</td>
<td>Database ORM</td>
</tr>
<tr>
<td><strong>Migrations</strong></td>
<td>Alembic</td>
<td>1.17.2</td>
<td>Schema versioning</td>
</tr>
<tr>
<td><strong>Async Driver</strong></td>
<td>asyncpg</td>
<td>0.31.0</td>
<td>Async PostgreSQL</td>
</tr>
</tbody>
</table>
<h3 id="aiml-stack">3.2 AI/ML Stack</h3>
<p><strong>Main Application:</strong> | Component | Technology | Purpose
| |â€”â€”â€”â€“|â€”â€”â€”â€”|â€”â€”â€”| | <strong>LLM Provider</strong> | Google Gemini 2.0
Flash | Recommendations &amp; NL Search | | <strong>HTTP Client</strong>
| httpx | Communication with RAG service |</p>
<p><strong>RAG Microservice (HuggingFace Spaces):</strong> | Component |
Technology | Purpose | |â€”â€”â€”â€“|â€”â€”â€”â€”|â€”â€”â€”| | <strong>Framework</strong> |
FastAPI | Microservice API | | <strong>LLM Provider</strong> | Google
Gemini 2.0 Flash | Answer generation | | <strong>Vector DB</strong> |
ChromaDB | Semantic search | | <strong>Embeddings</strong> | Sentence
Transformers (BAAI/bge-small-en-v1.5) | Text vectorization | |
<strong>PDF Parser</strong> | PyMuPDF (fitz) | Document extraction | |
<strong>Deployment</strong> | Docker on HuggingFace Spaces | Cloud
hosting |</p>
<h3 id="security-authentication">3.3 Security &amp; Authentication</h3>
<table>
<thead>
<tr>
<th>Component</th>
<th>Technology</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>JWT</strong></td>
<td>python-jose</td>
<td>Token generation</td>
</tr>
<tr>
<td><strong>Password Hashing</strong></td>
<td>Passlib (bcrypt)</td>
<td>Secure passwords</td>
</tr>
<tr>
<td><strong>Validation</strong></td>
<td>Pydantic</td>
<td>Input validation</td>
</tr>
<tr>
<td><strong>Email Validation</strong></td>
<td>email-validator</td>
<td>Email checking</td>
</tr>
</tbody>
</table>
<h3 id="devops-testing">3.4 DevOps &amp; Testing</h3>
<table>
<thead>
<tr>
<th>Component</th>
<th>Technology</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Testing</strong></td>
<td>pytest</td>
<td>Test framework</td>
</tr>
<tr>
<td><strong>Async Testing</strong></td>
<td>pytest-asyncio</td>
<td>Async test support</td>
</tr>
<tr>
<td><strong>HTTP Client</strong></td>
<td>httpx</td>
<td>API testing</td>
</tr>
<tr>
<td><strong>Test Data</strong></td>
<td>Faker</td>
<td>Mock data generation</td>
</tr>
<tr>
<td><strong>Containerization</strong></td>
<td>Docker</td>
<td>Application packaging</td>
</tr>
<tr>
<td><strong>Orchestration</strong></td>
<td>Docker Compose</td>
<td>Multi-container setup</td>
</tr>
</tbody>
</table>
<h3 id="development-tools">3.5 Development Tools</h3>
<table>
<thead>
<tr>
<th>Tool</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Poetry</strong></td>
<td>Dependency management</td>
</tr>
<tr>
<td><strong>uvicorn</strong></td>
<td>ASGI server</td>
</tr>
<tr>
<td><strong>python-multipart</strong></td>
<td>File upload support</td>
</tr>
<tr>
<td><strong>python-dotenv</strong></td>
<td>Environment management</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="core-features">4. Core Features</h2>
<h3 id="user-management">4.1 User Management</h3>
<p><strong>Capabilities:</strong> - âœ… User registration with email
validation - âœ… JWT-based authentication (access + refresh tokens) - âœ…
Role-based access control (Admin, Librarian, Member) - âœ… Profile
management (view/update) - âœ… Password hashing with bcrypt</p>
<p><strong>Endpoints:</strong></p>
<pre><code>POST   /auth/register          # Create new user
POST   /auth/login             # Authenticate user
POST   /auth/refresh           # Refresh access token
GET    /auth/me                # Get current user
GET    /users                  # List all users (Admin/Librarian)
GET    /users/{id}             # Get user by ID
PUT    /users/{id}             # Update user
DELETE /users/{id}             # Delete user (Admin only)</code></pre>
<h3 id="book-management">4.2 Book Management</h3>
<p><strong>Capabilities:</strong> - âœ… Full CRUD operations for books -
âœ… Advanced search with Full-Text Search (FTS) - âœ… Trigram-based fuzzy
matching - âœ… Multi-field filtering (author, genre, year) - âœ…
Cursor-based pagination - âœ… ISBN validation and uniqueness</p>
<p><strong>Endpoints:</strong></p>
<pre><code>GET    /books                  # List books with filters &amp; search
GET    /books/{id}             # Get book details
POST   /books                  # Create book (Admin/Librarian)
PUT    /books/{id}             # Update book (Admin/Librarian)
DELETE /books/{id}             # Delete book (Admin only)</code></pre>
<p><strong>Search Features:</strong> - <strong>FTS (Full-Text
Search):</strong> PostgreSQL <code>tsvector</code> for title/description
- <strong>Trigram Search:</strong> PostgreSQL <code>pg_trgm</code> for
fuzzy author matching - <strong>Filters:</strong> Author, genre,
publication year - <strong>Sorting:</strong> Ascending/descending by
ID</p>
<h3 id="borrowing-system">4.3 Borrowing System</h3>
<p><strong>Business Rules:</strong> - âœ… Members can borrow up to
<strong>5 books</strong> simultaneously - âœ… Default borrowing period:
<strong>14 days</strong> - âœ… Cannot borrow already-borrowed books - âœ…
Librarians/Admins can process returns - âœ… Overdue tracking</p>
<p><strong>Endpoints:</strong></p>
<pre><code>GET    /borrowings             # List user&#39;s borrowings
POST   /borrowings             # Borrow a book
PATCH  /borrowings/{id}/return # Return a book
GET    /borrowings/all         # All borrowings (Librarian/Admin)</code></pre>
<p><strong>Validation:</strong></p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Borrowing constraints</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>MAX_ACTIVE_BORROWINGS <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>DEFAULT_BORROW_DAYS <span class="op">=</span> <span class="dv">14</span></span></code></pre></div>
<h3 id="review-rating-system">4.4 Review &amp; Rating System</h3>
<p><strong>Capabilities:</strong> - âœ… Members can review borrowed books
- âœ… Rating scale: 1-5 stars - âœ… Optional text review - âœ… Average
rating calculation - âœ… One review per user per book</p>
<p><strong>Endpoints:</strong></p>
<pre><code>GET    /books/{id}/reviews        # Get book reviews
POST   /books/{id}/reviews        # Create review
PUT    /reviews/{id}              # Update review
DELETE /reviews/{id}              # Delete review
GET    /books/{id}/reviews/rating # Get average rating</code></pre>
<hr />
<h2 id="aiml-capabilities">5. AI/ML Capabilities</h2>
<h3 id="ai-powered-book-recommendations">5.1 AI-Powered Book
Recommendations</h3>
<p><strong>Algorithm Flow:</strong></p>
<pre class="mermaid"><code>graph LR
    A[User Request] --&gt; B[Fetch User History]
    B --&gt; C[Get Borrowings]
    B --&gt; D[Get Reviews]
    C --&gt; E[Extract Preferences]
    D --&gt; E
    E --&gt; F[Genre Relationship Mapping]
    F --&gt; G[Fetch Available Books]
    G --&gt; H[Send to Gemini AI]
    H --&gt; I[AI Ranking Algorithm]
    I --&gt; J[Return Top N Books]</code></pre>
<p><strong>Features:</strong> - Genre relationship mapping (e.g.,
Thriller â†’ Mystery, Crime) - User preference analysis from borrowing
history - Rating-weighted recommendations - Optional genre filtering -
Configurable limit (1-20 books)</p>
<p><strong>Endpoint:</strong></p>
<pre><code>GET /ai/books/recommend?genre=Thriller&amp;limit=5</code></pre>
<p><strong>Response:</strong></p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;user_id&quot;</span><span class="fu">:</span> <span class="dv">123</span><span class="fu">,</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;genre_filter&quot;</span><span class="fu">:</span> <span class="st">&quot;Thriller&quot;</span><span class="fu">,</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;recommendations&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span><span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="dv">5</span><span class="fu">,</span> <span class="dt">&quot;title&quot;</span><span class="fu">:</span> <span class="st">&quot;The Silent Patient&quot;</span><span class="fu">,</span> <span class="dt">&quot;author&quot;</span><span class="fu">:</span> <span class="st">&quot;Alex Michaelides&quot;</span><span class="fu">,</span> <span class="er">...</span><span class="fu">}</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;count&quot;</span><span class="fu">:</span> <span class="dv">5</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h3 id="natural-language-search">5.2 Natural Language Search</h3>
<p><strong>Two-Method Approach:</strong></p>
<h4 id="primary-sql-where-clause-generation"><strong>Primary: SQL WHERE
Clause Generation</strong></h4>
<p><strong>Flow:</strong></p>
<pre><code>Natural Language
      â†“
  Gemini AI
      â†“
SQL WHERE Clause
      â†“
Security Validation (SQL Injection Prevention)
      â†“
Fuzzy Matching (Fix Typos)
      â†“
  Execute Query</code></pre>
<p><strong>Example:</strong></p>
<pre><code>Input: &quot;fiction books from 2020&quot;

Generated SQL:
(title ILIKE &#39;%fiction%&#39; OR description ILIKE &#39;%fiction%&#39; OR genre ILIKE &#39;%fiction%&#39;) 
AND EXTRACT(YEAR FROM published_date) = 2020

Security Checks:
âœ… No dangerous keywords (DROP, DELETE, UNION)
âœ… Only allowed columns (title, author, genre, description, published_date)
âœ… No SQL injection patterns (;, --, /*)
âœ… Balanced parentheses</code></pre>
<h4 id="fallback-filter-extraction"><strong>Fallback: Filter
Extraction</strong></h4>
<p><strong>Flow:</strong></p>
<pre><code>Natural Language
      â†“
  Gemini AI
      â†“
Structured Filters
      â†“
Fuzzy Matching (Author/Genre)
      â†“
ILIKE Query</code></pre>
<p><strong>Example:</strong></p>
<pre><code>Input: &quot;thriller by hirenn from 2020&quot;

Extracted Filters:
{
  &quot;genre&quot;: &quot;Thriller&quot;,
  &quot;author&quot;: &quot;hirenn&quot;,
  &quot;published_year&quot;: 2020
}

After Fuzzy Matching:
{
  &quot;genre&quot;: &quot;Thriller&quot;,
  &quot;author&quot;: &quot;Hiren Patel&quot;,  â† Fixed typo!
  &quot;published_year&quot;: 2020
}</code></pre>
<p><strong>Endpoint:</strong></p>
<pre><code>POST /ai/books/search_nl
Body: {&quot;query&quot;: &quot;science fiction about space from 2020&quot;}</code></pre>
<p><strong>Validation Features:</strong> - SQL injection prevention (11
security checks) - Fuzzy matching for typos (difflib) - Author name
matching (prefix bonus, length penalty) - Genre correction (0.75
similarity threshold)</p>
<h3
id="rag-retrieval-augmented-generation---microservice-architecture">5.3
RAG (Retrieval-Augmented Generation) - Microservice Architecture</h3>
<p><strong>Deployed as Standalone Microservice on HuggingFace
Spaces</strong></p>
<p><strong>Complete RAG Pipeline:</strong></p>
<pre class="mermaid"><code>graph TB
    subgraph &quot;Main App (Render)&quot;
        A[User Upload PDF] --&gt; B[Main API: POST /rag/upload]
        B --&gt; C[Create DB Record]
        C --&gt; D[RAG HTTP Client]
        
        H[User Ask Question] --&gt; I[Main API: POST /rag/ask]
        I --&gt; J[Check Permissions]
        J --&gt; K[RAG HTTP Client]
    end
    
    subgraph &quot;RAG Microservice (HuggingFace)&quot;
        D --&gt;|HTTPS + API Key| E[POST /upload]
        E --&gt; F[PyMuPDF Extraction]
        F --&gt; G[Text Chunking]
        G --&gt; M[Generate Embeddings]
        M --&gt; N[Store in ChromaDB]
        
        K --&gt;|HTTPS + API Key| L[POST /ask]
        L --&gt; O[Embed Question]
        O --&gt; P[Vector Search]
        P --&gt; Q[Retrieve Chunks]
        Q --&gt; R[Build Context]
        R --&gt; S[Gemini AI]
        S --&gt; T[Generate Answer]
    end
    
    T --&gt; K
    N --&gt; D
    
    style A fill:#4CAF50
    style H fill:#4CAF50
    style T fill:#FF9800
    style E fill:#9C27B0
    style L fill:#9C27B0</code></pre>
<p><strong>Microservice Architecture:</strong> - ğŸ”— <strong>Main App
(Render):</strong> Handles auth, permissions, database - ğŸš€ <strong>RAG
Service (HuggingFace Spaces):</strong> Handles ML processing - ğŸ”
<strong>Communication:</strong> HTTPS with API key authentication - ğŸ“¦
<strong>Deployment:</strong> Docker container on HuggingFace</p>
<p><strong>Capabilities:</strong> - âœ… PDF document upload and
processing - âœ… Text extraction with page tracking - âœ… Intelligent
chunking (1200 chars, 200 overlap) - âœ… Vector embeddings (Sentence
Transformers) - âœ… Semantic search across documents - âœ… Multi-document
search - âœ… Document access control (user-owned docs) - âœ… Context-aware
answers with citations - âœ… Independent scaling for ML workloads - âœ…
Reduced main app deployment size (~500MB lighter)</p>
<p><strong>Endpoints:</strong></p>
<pre><code>POST   /rag/upload                 # Upload PDF
POST   /rag/ask                    # Ask question
DELETE /rag/documents/{id}         # Delete document</code></pre>
<p><strong>Technical Details:</strong></p>
<table>
<thead>
<tr>
<th>Component</th>
<th>Implementation</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Main App</strong></td>
<td>FastAPI on Render.com</td>
</tr>
<tr>
<td><strong>RAG Service</strong></td>
<td>FastAPI on HuggingFace Spaces</td>
</tr>
<tr>
<td><strong>Communication</strong></td>
<td>httpx async client with API key</td>
</tr>
<tr>
<td><strong>PDF Parser</strong></td>
<td>PyMuPDF (fitz)</td>
</tr>
<tr>
<td><strong>Chunking Strategy</strong></td>
<td>1200 chars max, 200 overlap</td>
</tr>
<tr>
<td><strong>Embedding Model</strong></td>
<td>BAAI/bge-small-en-v1.5 (384 dims)</td>
</tr>
<tr>
<td><strong>Vector Store</strong></td>
<td>ChromaDB with cosine similarity</td>
</tr>
<tr>
<td><strong>LLM</strong></td>
<td>Gemini 2.0 Flash</td>
</tr>
<tr>
<td><strong>Timeout Protection</strong></td>
<td>300s (5 minutes)</td>
</tr>
<tr>
<td><strong>Authentication</strong></td>
<td>X-API-Key header</td>
</tr>
<tr>
<td><strong>Service URL</strong></td>
<td>https://Hiren158-rag-microservice.hf.space</td>
</tr>
</tbody>
</table>
<p><strong>Example Usage:</strong></p>
<div class="sourceCode" id="cb19"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Upload document</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="ex">POST</span> /rag/upload</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="ex">File:</span> financial_report.pdf</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Ask questions</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="ex">POST</span> /rag/ask</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;question&quot;</span><span class="ex">:</span> <span class="st">&quot;What was the revenue in Q4 2023?&quot;</span>,</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;doc_id&quot;</span><span class="ex">:</span> 5,</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;top_k&quot;</span><span class="ex">:</span> 5</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="ex">Response:</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;answer&quot;</span><span class="ex">:</span> <span class="st">&quot;The revenue in Q4 2023 was </span><span class="va">$2</span><span class="st">.5 million...&quot;</span>,</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;context&quot;</span><span class="ex">:</span> [</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">{</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;text&quot;</span><span class="ex">:</span> <span class="st">&quot;Q4 2023 Financial Results...&quot;</span>,</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;score&quot;</span><span class="ex">:</span> 0.89,</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;page_number&quot;</span><span class="ex">:</span> 15,</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;section&quot;</span><span class="ex">:</span> <span class="st">&quot;Quarterly Results&quot;</span></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>  <span class="ex">]</span></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<hr />
<h2 id="database-design">6. Database Design</h2>
<h3 id="entity-relationship-diagram">6.1 Entity Relationship
Diagram</h3>
<pre class="mermaid"><code>erDiagram
    ROLES ||--o{ USERS : has
    USERS ||--o{ BORROWINGS : makes
    USERS ||--o{ REVIEWS : writes
    USERS ||--o{ RAG_DOCUMENTS : owns
    BOOKS ||--o{ BORROWINGS : borrowed_in
    BOOKS ||--o{ REVIEWS : receives
    
    ROLES {
        int id PK
        string name
        datetime created_at
    }
    
    USERS {
        int id PK
        string email UK
        string name
        string hashed_password
        int role_id FK
        datetime created_at
        datetime updated_at
    }
    
    BOOKS {
        int id PK
        string title
        string description
        string isbn UK
        string author
        string genre
        date published_date
        tsvector search_vector
        datetime created_at
        datetime updated_at
    }
    
    BORROWINGS {
        int id PK
        int user_id FK
        int book_id FK
        date borrowed_date
        date due_date
        date returned_date
        boolean is_returned
        datetime created_at
        datetime updated_at
    }
    
    REVIEWS {
        int id PK
        int user_id FK
        int book_id FK
        int rating
        string text
        datetime created_at
        datetime updated_at
    }
    
    RAG_DOCUMENTS {
        int id PK
        int user_id FK
        string filename
        int chunk_count
        datetime created_at
    }</code></pre>
<h3 id="table-specifications">6.2 Table Specifications</h3>
<h4 id="users-table"><strong>Users Table</strong></h4>
<div class="sourceCode" id="cb21"><pre
class="sourceCode sql"><code class="sourceCode sql"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> users (</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">id</span> SERIAL <span class="kw">PRIMARY</span> <span class="kw">KEY</span>,</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    email <span class="dt">VARCHAR</span>(<span class="dv">255</span>) <span class="kw">UNIQUE</span> <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    name <span class="dt">VARCHAR</span>(<span class="dv">255</span>) <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    hashed_password <span class="dt">VARCHAR</span>(<span class="dv">255</span>) <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    role_id <span class="dt">INTEGER</span> <span class="kw">REFERENCES</span> <span class="kw">roles</span>(<span class="kw">id</span>),</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    created_at <span class="dt">TIMESTAMP</span> <span class="kw">DEFAULT</span> NOW(),</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    updated_at <span class="dt">TIMESTAMP</span> <span class="kw">DEFAULT</span> NOW()</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>);</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">INDEX</span> idx_users_email <span class="kw">ON</span> users(email);</span></code></pre></div>
<h4 id="books-table"><strong>Books Table</strong></h4>
<div class="sourceCode" id="cb22"><pre
class="sourceCode sql"><code class="sourceCode sql"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> books (</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">id</span> SERIAL <span class="kw">PRIMARY</span> <span class="kw">KEY</span>,</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    title <span class="dt">VARCHAR</span>(<span class="dv">255</span>) <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    description TEXT,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    isbn <span class="dt">VARCHAR</span>(<span class="dv">20</span>) <span class="kw">UNIQUE</span> <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    author <span class="dt">VARCHAR</span>(<span class="dv">255</span>) <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    genre <span class="dt">VARCHAR</span>(<span class="dv">100</span>),</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    published_date <span class="dt">DATE</span>,</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    search_vector TSVECTOR,  <span class="co">-- Full-text search</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    created_at <span class="dt">TIMESTAMP</span> <span class="kw">DEFAULT</span> NOW(),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    updated_at <span class="dt">TIMESTAMP</span> <span class="kw">DEFAULT</span> NOW()</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>);</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a><span class="co">-- Indexes for performance</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">INDEX</span> idx_books_isbn <span class="kw">ON</span> books(isbn);</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">INDEX</span> idx_books_author <span class="kw">ON</span> books <span class="kw">USING</span> gin(author gin_trgm_ops);</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">INDEX</span> idx_books_search_vector <span class="kw">ON</span> books <span class="kw">USING</span> gin(search_vector);</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a><span class="co">-- Trigger for automatic FTS vector update</span></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TRIGGER</span> books_search_vector_update</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a><span class="kw">BEFORE</span> <span class="kw">INSERT</span> <span class="kw">OR</span> <span class="kw">UPDATE</span> <span class="kw">ON</span> books</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a><span class="cf">FOR</span> <span class="kw">EACH</span> <span class="kw">ROW</span> <span class="kw">EXECUTE</span> <span class="kw">FUNCTION</span></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>tsvector_update_trigger(search_vector, <span class="st">&#39;pg_catalog.english&#39;</span>, title, description);</span></code></pre></div>
<h4 id="borrowings-table"><strong>Borrowings Table</strong></h4>
<div class="sourceCode" id="cb23"><pre
class="sourceCode sql"><code class="sourceCode sql"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> borrowings (</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">id</span> SERIAL <span class="kw">PRIMARY</span> <span class="kw">KEY</span>,</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    user_id <span class="dt">INTEGER</span> <span class="kw">REFERENCES</span> users(<span class="kw">id</span>) <span class="kw">ON</span> <span class="kw">DELETE</span> <span class="kw">CASCADE</span>,</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    book_id <span class="dt">INTEGER</span> <span class="kw">REFERENCES</span> books(<span class="kw">id</span>) <span class="kw">ON</span> <span class="kw">DELETE</span> <span class="kw">CASCADE</span>,</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    borrowed_date <span class="dt">DATE</span> <span class="kw">NOT</span> <span class="kw">NULL</span> <span class="kw">DEFAULT</span> <span class="fu">CURRENT_DATE</span>,</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    due_date <span class="dt">DATE</span> <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    returned_date <span class="dt">DATE</span>,</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    is_returned <span class="dt">BOOLEAN</span> <span class="kw">DEFAULT</span> <span class="kw">FALSE</span>,</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>    created_at <span class="dt">TIMESTAMP</span> <span class="kw">DEFAULT</span> NOW(),</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>    updated_at <span class="dt">TIMESTAMP</span> <span class="kw">DEFAULT</span> NOW(),</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">CONSTRAINT</span> unique_active_borrowing </span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>        <span class="kw">UNIQUE</span> (book_id, is_returned) </span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>        <span class="kw">WHERE</span> is_returned <span class="op">=</span> <span class="kw">FALSE</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>);</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">INDEX</span> idx_borrowings_user <span class="kw">ON</span> borrowings(user_id);</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">INDEX</span> idx_borrowings_book <span class="kw">ON</span> borrowings(book_id);</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">INDEX</span> idx_borrowings_status <span class="kw">ON</span> borrowings(is_returned);</span></code></pre></div>
<h4 id="reviews-table"><strong>Reviews Table</strong></h4>
<div class="sourceCode" id="cb24"><pre
class="sourceCode sql"><code class="sourceCode sql"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> reviews (</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">id</span> SERIAL <span class="kw">PRIMARY</span> <span class="kw">KEY</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    user_id <span class="dt">INTEGER</span> <span class="kw">REFERENCES</span> users(<span class="kw">id</span>) <span class="kw">ON</span> <span class="kw">DELETE</span> <span class="kw">CASCADE</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    book_id <span class="dt">INTEGER</span> <span class="kw">REFERENCES</span> books(<span class="kw">id</span>) <span class="kw">ON</span> <span class="kw">DELETE</span> <span class="kw">CASCADE</span>,</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    rating <span class="dt">INTEGER</span> <span class="kw">CHECK</span> (rating <span class="op">&gt;=</span> <span class="dv">1</span> <span class="kw">AND</span> rating <span class="op">&lt;=</span> <span class="dv">5</span>),</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    text TEXT,</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>    created_at <span class="dt">TIMESTAMP</span> <span class="kw">DEFAULT</span> NOW(),</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    updated_at <span class="dt">TIMESTAMP</span> <span class="kw">DEFAULT</span> NOW(),</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">CONSTRAINT</span> unique_user_book_review <span class="kw">UNIQUE</span> (user_id, book_id)</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>);</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">INDEX</span> idx_reviews_book <span class="kw">ON</span> reviews(book_id);</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">INDEX</span> idx_reviews_rating <span class="kw">ON</span> reviews(rating);</span></code></pre></div>
<h3 id="database-features">6.3 Database Features</h3>
<p><strong>PostgreSQL Extensions:</strong></p>
<div class="sourceCode" id="cb25"><pre
class="sourceCode sql"><code class="sourceCode sql"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> EXTENSION <span class="cf">IF</span> <span class="kw">NOT</span> <span class="kw">EXISTS</span> pg_trgm;  <span class="co">-- Trigram fuzzy matching</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> EXTENSION <span class="cf">IF</span> <span class="kw">NOT</span> <span class="kw">EXISTS</span> btree_gin; <span class="co">-- GIN index optimization</span></span></code></pre></div>
<p><strong>Performance Optimizations:</strong> - GIN indexes for
full-text search - Trigram indexes for fuzzy matching - Composite
indexes for common queries - Automatic search vector updates via
triggers</p>
<hr />
<h2 id="api-documentation">7. API Documentation</h2>
<h3 id="authentication-endpoints">7.1 Authentication Endpoints</h3>
<table>
<thead>
<tr>
<th>Method</th>
<th>Endpoint</th>
<th>Description</th>
<th>Auth Required</th>
<th>Roles</th>
</tr>
</thead>
<tbody>
<tr>
<td>POST</td>
<td><code>/auth/register</code></td>
<td>Create new user</td>
<td>âŒ</td>
<td>Public</td>
</tr>
<tr>
<td>POST</td>
<td><code>/auth/login</code></td>
<td>Authenticate &amp; get tokens</td>
<td>âŒ</td>
<td>Public</td>
</tr>
<tr>
<td>POST</td>
<td><code>/auth/refresh</code></td>
<td>Refresh access token</td>
<td>âŒ</td>
<td>Public</td>
</tr>
<tr>
<td>GET</td>
<td><code>/auth/me</code></td>
<td>Get current user profile</td>
<td>âœ…</td>
<td>All</td>
</tr>
</tbody>
</table>
<h3 id="book-endpoints">7.2 Book Endpoints</h3>
<table>
<thead>
<tr>
<th>Method</th>
<th>Endpoint</th>
<th>Description</th>
<th>Auth Required</th>
<th>Roles</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td><code>/books</code></td>
<td>List/search books</td>
<td>âŒ</td>
<td>Public</td>
</tr>
<tr>
<td>GET</td>
<td><code>/books/{id}</code></td>
<td>Get book details</td>
<td>âŒ</td>
<td>Public</td>
</tr>
<tr>
<td>POST</td>
<td><code>/books</code></td>
<td>Create new book</td>
<td>âœ…</td>
<td>Admin, Librarian</td>
</tr>
<tr>
<td>PUT</td>
<td><code>/books/{id}</code></td>
<td>Update book</td>
<td>âœ…</td>
<td>Admin, Librarian</td>
</tr>
<tr>
<td>DELETE</td>
<td><code>/books/{id}</code></td>
<td>Delete book</td>
<td>âœ…</td>
<td>Admin</td>
</tr>
</tbody>
</table>
<p><strong>Query Parameters for <code>/books</code>:</strong></p>
<pre><code>?search=keyword          # Full-text search
?author=name            # Filter by author
?genre=genre            # Filter by genre
?published_year=2020    # Filter by year
?limit=10               # Page size (1-100)
?cursor=base64          # Pagination cursor
?sort_order=desc        # asc or desc</code></pre>
<h3 id="borrowing-endpoints">7.3 Borrowing Endpoints</h3>
<table>
<colgroup>
<col style="width: 15%" />
<col style="width: 18%" />
<col style="width: 24%" />
<col style="width: 28%" />
<col style="width: 13%" />
</colgroup>
<thead>
<tr>
<th>Method</th>
<th>Endpoint</th>
<th>Description</th>
<th>Auth Required</th>
<th>Roles</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td><code>/borrowings</code></td>
<td>List my borrowings</td>
<td>âœ…</td>
<td>Member</td>
</tr>
<tr>
<td>POST</td>
<td><code>/borrowings</code></td>
<td>Borrow a book</td>
<td>âœ…</td>
<td>Member</td>
</tr>
<tr>
<td>PATCH</td>
<td><code>/borrowings/{id}/return</code></td>
<td>Return a book</td>
<td>âœ…</td>
<td>Librarian, Admin</td>
</tr>
<tr>
<td>GET</td>
<td><code>/borrowings/all</code></td>
<td>All borrowings</td>
<td>âœ…</td>
<td>Librarian, Admin</td>
</tr>
</tbody>
</table>
<h3 id="review-endpoints">7.4 Review Endpoints</h3>
<table>
<thead>
<tr>
<th>Method</th>
<th>Endpoint</th>
<th>Description</th>
<th>Auth Required</th>
<th>Roles</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td><code>/books/{id}/reviews</code></td>
<td>Get book reviews</td>
<td>âŒ</td>
<td>Public</td>
</tr>
<tr>
<td>POST</td>
<td><code>/books/{id}/reviews</code></td>
<td>Create review</td>
<td>âœ…</td>
<td>Member</td>
</tr>
<tr>
<td>PUT</td>
<td><code>/reviews/{id}</code></td>
<td>Update review</td>
<td>âœ…</td>
<td>Member (own)</td>
</tr>
<tr>
<td>DELETE</td>
<td><code>/reviews/{id}</code></td>
<td>Delete review</td>
<td>âœ…</td>
<td>Member (own)</td>
</tr>
<tr>
<td>GET</td>
<td><code>/books/{id}/reviews/rating</code></td>
<td>Get avg rating</td>
<td>âŒ</td>
<td>Public</td>
</tr>
</tbody>
</table>
<h3 id="ai-endpoints">7.5 AI Endpoints</h3>
<table>
<thead>
<tr>
<th>Method</th>
<th>Endpoint</th>
<th>Description</th>
<th>Auth Required</th>
<th>Roles</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td><code>/ai/books/recommend</code></td>
<td>Get recommendations</td>
<td>âœ…</td>
<td>All</td>
</tr>
<tr>
<td>POST</td>
<td><code>/ai/books/search_nl</code></td>
<td>Natural language search</td>
<td>âŒ</td>
<td>Public</td>
</tr>
</tbody>
</table>
<h3 id="rag-endpoints">7.6 RAG Endpoints</h3>
<table>
<thead>
<tr>
<th>Method</th>
<th>Endpoint</th>
<th>Description</th>
<th>Auth Required</th>
<th>Roles</th>
</tr>
</thead>
<tbody>
<tr>
<td>POST</td>
<td><code>/rag/upload</code></td>
<td>Upload PDF document</td>
<td>âœ…</td>
<td>All</td>
</tr>
<tr>
<td>POST</td>
<td><code>/rag/ask</code></td>
<td>Ask question about docs</td>
<td>âœ…</td>
<td>All</td>
</tr>
<tr>
<td>DELETE</td>
<td><code>/rag/documents/{id}</code></td>
<td>Delete document</td>
<td>âœ…</td>
<td>Owner/Admin</td>
</tr>
</tbody>
</table>
<h3 id="interactive-api-documentation">7.7 Interactive API
Documentation</h3>
<p><strong>Swagger UI:</strong>
<code>http://localhost:8000/docs</code><br />
<strong>ReDoc:</strong> <code>http://localhost:8000/redoc</code></p>
<hr />
<h2 id="security-authentication-1">8. Security &amp; Authentication</h2>
<h3 id="jwt-token-system">8.1 JWT Token System</h3>
<p><strong>Token Types:</strong> - <strong>Access Token:</strong> 30
minutes validity, used for API requests - <strong>Refresh
Token:</strong> 7 days validity, used to get new access tokens</p>
<p><strong>Token Structure:</strong></p>
<div class="sourceCode" id="cb27"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;sub&quot;</span><span class="fu">:</span> <span class="st">&quot;user@example.com&quot;</span><span class="fu">,</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;user_id&quot;</span><span class="fu">:</span> <span class="dv">123</span><span class="fu">,</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;role&quot;</span><span class="fu">:</span> <span class="st">&quot;Member&quot;</span><span class="fu">,</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;exp&quot;</span><span class="fu">:</span> <span class="dv">1234567890</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p><strong>Security Features:</strong> - HS256 algorithm - Separate
secrets for access &amp; refresh tokens - Password hashing with bcrypt
(cost factor: 12) - Token expiration validation - Role-based access
control</p>
<h3 id="role-based-access-control-rbac">8.2 Role-Based Access Control
(RBAC)</h3>
<p><strong>Role Hierarchy:</strong></p>
<pre><code>Admin (Full Access)
  â”œâ”€ User Management (CRUD)
  â”œâ”€ Book Management (CRUD)
  â””â”€ System Configuration

Librarian (Moderate Access)
  â”œâ”€ User Management (Read/Update)
  â”œâ”€ Book Management (CRUD)
  â””â”€ Borrowing Management

Member (Limited Access)
  â”œâ”€ Browse Books (Read)
  â”œâ”€ Borrow Books
  â”œâ”€ Write Reviews
  â””â”€ View Own Profile</code></pre>
<p><strong>Permission Matrix:</strong></p>
<table>
<thead>
<tr>
<th>Resource</th>
<th>Action</th>
<th style="text-align: center;">Member</th>
<th style="text-align: center;">Librarian</th>
<th style="text-align: center;">Admin</th>
</tr>
</thead>
<tbody>
<tr>
<td>Books</td>
<td>View</td>
<td style="text-align: center;">âœ…</td>
<td style="text-align: center;">âœ…</td>
<td style="text-align: center;">âœ…</td>
</tr>
<tr>
<td>Books</td>
<td>Create</td>
<td style="text-align: center;">âŒ</td>
<td style="text-align: center;">âœ…</td>
<td style="text-align: center;">âœ…</td>
</tr>
<tr>
<td>Books</td>
<td>Update</td>
<td style="text-align: center;">âŒ</td>
<td style="text-align: center;">âœ…</td>
<td style="text-align: center;">âœ…</td>
</tr>
<tr>
<td>Books</td>
<td>Delete</td>
<td style="text-align: center;">âŒ</td>
<td style="text-align: center;">âŒ</td>
<td style="text-align: center;">âœ…</td>
</tr>
<tr>
<td>Borrowings</td>
<td>Create</td>
<td style="text-align: center;">âœ…</td>
<td style="text-align: center;">âŒ</td>
<td style="text-align: center;">âŒ</td>
</tr>
<tr>
<td>Borrowings</td>
<td>Return</td>
<td style="text-align: center;">âŒ</td>
<td style="text-align: center;">âœ…</td>
<td style="text-align: center;">âœ…</td>
</tr>
<tr>
<td>Reviews</td>
<td>Create</td>
<td style="text-align: center;">âœ…</td>
<td style="text-align: center;">âŒ</td>
<td style="text-align: center;">âŒ</td>
</tr>
<tr>
<td>Users</td>
<td>View</td>
<td style="text-align: center;">âŒ</td>
<td style="text-align: center;">âœ…</td>
<td style="text-align: center;">âœ…</td>
</tr>
<tr>
<td>Users</td>
<td>Delete</td>
<td style="text-align: center;">âŒ</td>
<td style="text-align: center;">âŒ</td>
<td style="text-align: center;">âœ…</td>
</tr>
</tbody>
</table>
<h3 id="security-measures">8.3 Security Measures</h3>
<p><strong>SQL Injection Prevention:</strong> - Parameterized queries
via SQLAlchemy - AI-generated SQL validation (11 security checks) -
Whitelist-based column validation - Blocked dangerous keywords (DROP,
DELETE, UNION)</p>
<p><strong>Input Validation:</strong> - Pydantic schema validation -
Email format validation - Password strength requirements - ISBN format
validation - Rating range validation (1-5)</p>
<p><strong>Data Protection:</strong> - Password hashing (never stored in
plaintext) - Sensitive data excluded from responses - Environment
variable for secrets - HTTPS recommended for production</p>
<hr />
<h2 id="testing-quality-assurance">9. Testing &amp; Quality
Assurance</h2>
<h3 id="test-structure">9.1 Test Structure</h3>
<pre><code>tests/
â”œâ”€â”€ unit/
â”‚   â”œâ”€â”€ test_auth.py
â”‚   â”œâ”€â”€ test_book_service.py
â”‚   â”œâ”€â”€ test_borrowing.py
â”‚   â”œâ”€â”€ test_reviews.py
â”‚   â”œâ”€â”€ test_ai_tools.py
â”‚   â””â”€â”€ test_sql_validator.py
â”‚
â””â”€â”€ integration/
    â”œâ”€â”€ test_api_auth.py
    â”œâ”€â”€ test_api_books.py
    â”œâ”€â”€ test_api_borrowings.py
    â””â”€â”€ test_api_reviews.py</code></pre>
<h3 id="testing-tools">9.2 Testing Tools</h3>
<table>
<thead>
<tr>
<th>Tool</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>pytest</strong></td>
<td>Test framework</td>
</tr>
<tr>
<td><strong>pytest-asyncio</strong></td>
<td>Async test support</td>
</tr>
<tr>
<td><strong>httpx</strong></td>
<td>HTTP client for API testing</td>
</tr>
<tr>
<td><strong>Faker</strong></td>
<td>Generate test data</td>
</tr>
<tr>
<td><strong>aiosqlite</strong></td>
<td>In-memory DB for tests</td>
</tr>
</tbody>
</table>
<h3 id="test-coverage">9.3 Test Coverage</h3>
<p><strong>Unit Tests:</strong> - âœ… Authentication &amp; JWT - âœ…
Password hashing - âœ… Business logic validation - âœ… AI tools (fuzzy
matching, validation) - âœ… SQL injection prevention</p>
<p><strong>Integration Tests:</strong> - âœ… API endpoint testing - âœ…
Database operations - âœ… RBAC enforcement - âœ… End-to-end workflows</p>
<p><strong>Running Tests:</strong></p>
<div class="sourceCode" id="cb30"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># All tests</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="ex">poetry</span> run pytest</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Unit tests only</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="ex">poetry</span> run pytest tests/unit/ <span class="at">-v</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Integration tests only</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="ex">poetry</span> run pytest tests/integration/ <span class="at">-v</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="co"># With coverage</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="ex">poetry</span> run pytest <span class="at">--cov</span><span class="op">=</span>src <span class="at">--cov-report</span><span class="op">=</span>html</span></code></pre></div>
<hr />
<h2 id="deployment">10. Deployment</h2>
<h3 id="docker-deployment">10.1 Docker Deployment</h3>
<p><strong>Dockerfile:</strong></p>
<div class="sourceCode" id="cb31"><pre
class="sourceCode dockerfile"><code class="sourceCode dockerfile"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> python:3.11-slim</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="kw">WORKDIR</span> /app</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Install system dependencies</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">apt-get</span> update <span class="kw">&amp;&amp;</span> <span class="ex">apt-get</span> install <span class="at">-y</span> postgresql-client</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Install Python dependencies</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> pyproject.toml poetry.lock ./</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">pip</span> install poetry <span class="kw">&amp;&amp;</span> <span class="ex">poetry</span> install <span class="at">--no-dev</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Copy application code</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> . .</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Run migrations and start server</span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a><span class="kw">CMD</span> <span class="ex">poetry</span> run alembic upgrade head <span class="kw">&amp;&amp;</span> <span class="dt">\</span></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>    <span class="ex">poetry</span> run uvicorn main:app <span class="at">--host</span> 0.0.0.0 <span class="at">--port</span> 8000</span></code></pre></div>
<p><strong>Docker Compose:</strong></p>
<div class="sourceCode" id="cb32"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">services</span><span class="kw">:</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">api</span><span class="kw">:</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">build</span><span class="kw">:</span><span class="at"> .</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">&quot;8000:8000&quot;</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> DATABASE_URL=postgresql://postgres:password@db/book_db</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">depends_on</span><span class="kw">:</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> db</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="at">    </span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">db</span><span class="kw">:</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> postgres:15-alpine</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> POSTGRES_DB=book_db</span></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> POSTGRES_PASSWORD=password</span></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> postgres_data:/var/lib/postgresql/data</span></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a><span class="at">    </span></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">postgres_data</span><span class="kw">:</span></span></code></pre></div>
<h3 id="environment-variables">10.2 Environment Variables</h3>
<p><strong>Required:</strong></p>
<pre class="env"><code>DATABASE_URL=postgresql://user:pass@host:5432/dbname
JWT_SECRET_KEY=your-secret-key-256-bits
JWT_REFRESH_SECRET_KEY=your-refresh-secret-256-bits
GEMINI_API_KEY=your-gemini-api-key</code></pre>
<p><strong>Optional:</strong></p>
<pre class="env"><code>ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30
REFRESH_TOKEN_EXPIRE_DAYS=7</code></pre>
<h3 id="production-deployment-render.com">10.3 Production Deployment
(Render.com)</h3>
<p><strong>Features:</strong> - âœ… Free tier hosting - âœ… Automatic
deployments from GitHub - âœ… PostgreSQL database included - âœ…
Environment variable management - âœ… Health check endpoint</p>
<p><strong>render.yaml:</strong></p>
<div class="sourceCode" id="cb35"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">services</span><span class="kw">:</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">type</span><span class="kw">:</span><span class="at"> web</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">name</span><span class="kw">:</span><span class="at"> book-management-api</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">runtime</span><span class="kw">:</span><span class="at"> python</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">buildCommand</span><span class="kw">:</span><span class="at"> poetry install</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">startCommand</span><span class="kw">:</span><span class="at"> poetry run alembic upgrade head &amp;&amp; poetry run uvicorn main:app --host 0.0.0.0</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">envVars</span><span class="kw">:</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">key</span><span class="kw">:</span><span class="at"> DATABASE_URL</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">fromDatabase</span><span class="kw">:</span><span class="at"> name: book_db</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">key</span><span class="kw">:</span><span class="at"> JWT_SECRET_KEY</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">generateValue</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">key</span><span class="kw">:</span><span class="at"> GEMINI_API_KEY</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">sync</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a><span class="fu">databases</span><span class="kw">:</span></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> book_db</span></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">databaseName</span><span class="kw">:</span><span class="at"> book_management</span></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">plan</span><span class="kw">:</span><span class="at"> free</span></span></code></pre></div>
<hr />
<h2 id="performance-optimizations">11. Performance Optimizations</h2>
<h3 id="database-optimizations">11.1 Database Optimizations</h3>
<p><strong>Indexing Strategy:</strong></p>
<div class="sourceCode" id="cb36"><pre
class="sourceCode sql"><code class="sourceCode sql"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Primary key indexes (automatic)</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="co">-- Email lookup</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">INDEX</span> idx_users_email <span class="kw">ON</span> users(email);</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="co">-- Book searches</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">INDEX</span> idx_books_isbn <span class="kw">ON</span> books(isbn);</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">INDEX</span> idx_books_author <span class="kw">ON</span> books <span class="kw">USING</span> gin(author gin_trgm_ops);</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">INDEX</span> idx_books_search_vector <span class="kw">ON</span> books <span class="kw">USING</span> gin(search_vector);</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a><span class="co">-- Borrowing queries</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">INDEX</span> idx_borrowings_user <span class="kw">ON</span> borrowings(user_id);</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">INDEX</span> idx_borrowings_book <span class="kw">ON</span> borrowings(book_id);</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">INDEX</span> idx_borrowings_status <span class="kw">ON</span> borrowings(is_returned);</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a><span class="co">-- Reviews</span></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">INDEX</span> idx_reviews_book <span class="kw">ON</span> reviews(book_id);</span></code></pre></div>
<p><strong>Query Optimizations:</strong> - Eager loading with
<code>selectinload()</code> to prevent N+1 queries - Cursor-based
pagination for large datasets - Connection pooling (asyncpg)</p>
<h3 id="application-optimizations">11.2 Application Optimizations</h3>
<p><strong>Async I/O:</strong> - All database operations are async -
Non-blocking I/O for API requests - Concurrent request handling</p>
<p><strong>Caching:</strong> - Gemini model instance caching - Lazy
initialization to reduce startup time</p>
<p><strong>Vector Search:</strong> - ChromaDB for fast semantic search
(&lt; 100ms for 1M documents) - Embedding caching</p>
<h3 id="ai-performance">11.3 AI Performance</h3>
<table>
<thead>
<tr>
<th>Operation</th>
<th>Typical Latency</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Gemini API Call</strong></td>
<td>500-2000ms</td>
</tr>
<tr>
<td><strong>Vector Search</strong></td>
<td>10-100ms</td>
</tr>
<tr>
<td><strong>Embedding Generation</strong></td>
<td>50-500ms</td>
</tr>
<tr>
<td><strong>SQL Generation</strong></td>
<td>500-1500ms</td>
</tr>
<tr>
<td><strong>Filter Extraction</strong></td>
<td>300-1000ms</td>
</tr>
</tbody>
</table>
<p><strong>Optimizations:</strong> - Timeout protection (60s for RAG) -
Fallback mechanisms - Batch processing for embeddings</p>
<hr />
<h2 id="project-structure">12. Project Structure</h2>
<h3 id="directory-tree">12.1 Directory Tree</h3>
<pre><code>book-management-main/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ endpoints/
â”‚   â”‚   â”‚   â”œâ”€â”€ auth_route.py          # Authentication endpoints
â”‚   â”‚   â”‚   â”œâ”€â”€ books_route.py         # Book CRUD endpoints
â”‚   â”‚   â”‚   â”œâ”€â”€ borrowings_route.py    # Borrowing management
â”‚   â”‚   â”‚   â”œâ”€â”€ reviews_route.py       # Review system
â”‚   â”‚   â”‚   â”œâ”€â”€ users_route.py         # User management
â”‚   â”‚   â”‚   â”œâ”€â”€ ai_tools_route.py      # AI features
â”‚   â”‚   â”‚   â””â”€â”€ rag.py                 # RAG endpoints
â”‚   â”‚   â””â”€â”€ dependencies.py            # Auth dependencies
â”‚   â”‚
â”‚   â”œâ”€â”€ model/
â”‚   â”‚   â”œâ”€â”€ user.py                    # User model
â”‚   â”‚   â”œâ”€â”€ book.py                    # Book model
â”‚   â”‚   â”œâ”€â”€ borrowing.py               # Borrowing model
â”‚   â”‚   â”œâ”€â”€ review.py                  # Review model
â”‚   â”‚   â”œâ”€â”€ role.py                    # Role model
â”‚   â”‚   â””â”€â”€ rag_document.py            # RAG document model
â”‚   â”‚
â”‚   â”œâ”€â”€ schema/
â”‚   â”‚   â”œâ”€â”€ user.py                    # User Pydantic schemas
â”‚   â”‚   â”œâ”€â”€ book.py                    # Book schemas
â”‚   â”‚   â”œâ”€â”€ borrowing.py               # Borrowing schemas
â”‚   â”‚   â”œâ”€â”€ review.py                  # Review schemas
â”‚   â”‚   â”œâ”€â”€ auth.py                    # Auth schemas
â”‚   â”‚   â”œâ”€â”€ rag_models.py              # RAG schemas
â”‚   â”‚   â””â”€â”€ common.py                  # Shared schemas
â”‚   â”‚
â”‚   â”œâ”€â”€ repository/
â”‚   â”‚   â”œâ”€â”€ user.py                    # User data access
â”‚   â”‚   â”œâ”€â”€ book.py                    # Book data access
â”‚   â”‚   â”œâ”€â”€ borrowing.py               # Borrowing data access
â”‚   â”‚   â”œâ”€â”€ review.py                  # Review data access
â”‚   â”‚   â””â”€â”€ rag_document.py            # RAG data access
â”‚   â”‚
â”‚   â”œâ”€â”€ service/
â”‚   â”‚   â”œâ”€â”€ auth.py                    # Authentication logic
â”‚   â”‚   â”œâ”€â”€ user.py                    # User business logic
â”‚   â”‚   â”œâ”€â”€ book.py                    # Book business logic
â”‚   â”‚   â”œâ”€â”€ borrowing.py               # Borrowing logic
â”‚   â”‚   â”œâ”€â”€ review.py                  # Review logic
â”‚   â”‚   â”œâ”€â”€ ai.py                      # AI recommendation service
â”‚   â”‚   â”œâ”€â”€ ai_search.py               # Gemini model provider
â”‚   â”‚   â”œâ”€â”€ embedding_service.py       # Vector embeddings
â”‚   â”‚   â”œâ”€â”€ pdf_service.py             # PDF processing
â”‚   â”‚   â”œâ”€â”€ vector_store.py            # ChromaDB interface
â”‚   â”‚   â””â”€â”€ rag_document.py            # RAG document service
â”‚   â”‚
â”‚   â”œâ”€â”€ tools/
â”‚   â”‚   â””â”€â”€ ai_tools.py                # AI utilities
â”‚   â”‚       â”œâ”€â”€ recommend_books_ai()
â”‚   â”‚       â”œâ”€â”€ nl_to_filters()
â”‚   â”‚       â”œâ”€â”€ nl_to_sql_where()
â”‚   â”‚       â”œâ”€â”€ validate_filters()
â”‚   â”‚       â””â”€â”€ fuzzy matching helpers
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ sql_validator.py           # SQL injection prevention
â”‚   â”‚   â””â”€â”€ text_chunker.py            # RAG text chunking
â”‚   â”‚
â”‚   â””â”€â”€ core/
â”‚       â””â”€â”€ database.py                # DB configuration
â”‚
â”œâ”€â”€ alembic/
â”‚   â”œâ”€â”€ versions/
â”‚   â”‚   â”œâ”€â”€ 9d1901b3d623_initial_schema.py
â”‚   â”‚   â””â”€â”€ aa376f4a6cc4_add_rag_documents_table_for_rbac.py
â”‚   â””â”€â”€ env.py
â”‚
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ unit/
â”‚   â””â”€â”€ integration/
â”‚
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ verify_fts.sh                  # FTS testing
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ main.py                            # Application entry point
â”œâ”€â”€ docker-compose.yml                 # Docker orchestration
â”œâ”€â”€ Dockerfile                         # Container definition
â”œâ”€â”€ pyproject.toml                     # Dependencies
â”œâ”€â”€ alembic.ini                        # Migration config
â”œâ”€â”€ pytest.ini                         # Test configuration
â”œâ”€â”€ README.md                          # Documentation
â”œâ”€â”€ RBAC.md                            # RBAC documentation
â”œâ”€â”€ DEPLOYMENT.md                      # Deployment guide
â””â”€â”€ .env.example                       # Environment template</code></pre>
<h3 id="code-statistics">12.2 Code Statistics</h3>
<table>
<thead>
<tr>
<th>Category</th>
<th>Lines of Code</th>
<th>Files</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>API Routes</strong></td>
<td>~2,500</td>
<td>8</td>
</tr>
<tr>
<td><strong>Models</strong></td>
<td>~500</td>
<td>6</td>
</tr>
<tr>
<td><strong>Repositories</strong></td>
<td>~1,200</td>
<td>5</td>
</tr>
<tr>
<td><strong>Services</strong></td>
<td>~1,800</td>
<td>10</td>
</tr>
<tr>
<td><strong>AI Tools</strong></td>
<td>~700</td>
<td>1</td>
</tr>
<tr>
<td><strong>Utils</strong></td>
<td>~400</td>
<td>3</td>
</tr>
<tr>
<td><strong>Tests</strong></td>
<td>~1,500</td>
<td>15+</td>
</tr>
<tr>
<td><strong>Total</strong></td>
<td>~8,600+</td>
<td>50+</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="key-innovations">13. Key Innovations</h2>
<h3 id="dual-search-strategy">13.1 Dual Search Strategy</h3>
<p><strong>Innovation:</strong> Two-tier AI search with automatic
fallback</p>
<pre><code>Primary (SQL WHERE) â†’ Fast + Powerful
         â†“ (if fails)
Fallback (Filters) â†’ Reliable + Safe</code></pre>
<p><strong>Benefits:</strong> - Maximum search power when AI works
perfectly - Guaranteed results with fallback - Security validation
prevents SQL injection</p>
<h3 id="fuzzy-matching-system">13.2 Fuzzy Matching System</h3>
<p><strong>Innovation:</strong> Multi-level typo correction</p>
<ol type="1">
<li><strong>Author Matching:</strong> Custom scoring with prefix
bonus</li>
<li><strong>Genre Matching:</strong> Database-aware fuzzy matching</li>
<li><strong>SQL Correction:</strong> Fix typos in generated SQL</li>
</ol>
<p><strong>Example:</strong></p>
<pre><code>User types: &quot;books by hirenn&quot;
System fixes: &quot;Hiren Patel&quot; (similarity: 0.85)</code></pre>
<h3 id="rag-with-access-control">13.3 RAG with Access Control</h3>
<p><strong>Innovation:</strong> User-scoped document search</p>
<pre><code>User uploads PDF â†’ Stored with ownership
User queries â†’ Only searches own docs (or all with permission)</code></pre>
<p><strong>Security:</strong> Document-level RBAC prevents unauthorized
access</p>
<hr />
<h2 id="future-enhancements">14. Future Enhancements</h2>
<h3 id="planned-features">14.1 Planned Features</h3>
<ul class="task-list">
<li><label><input type="checkbox" /><strong>Vector-Based Book
Recommendations</strong> (scale to millions)</label></li>
<li><label><input type="checkbox" /><strong>Book Cover Image
Upload</strong></label></li>
<li><label><input type="checkbox" /><strong>Advanced Analytics
Dashboard</strong></label></li>
<li><label><input type="checkbox" /><strong>Email Notifications</strong>
(overdue reminders)</label></li>
<li><label><input type="checkbox" /><strong>Book
Reservations</strong></label></li>
<li><label><input type="checkbox" /><strong>Multi-language
Support</strong></label></li>
<li><label><input type="checkbox" /><strong>Book
Categories/Tags</strong></label></li>
<li><label><input type="checkbox" /><strong>Reading
Lists</strong></label></li>
</ul>
<h3 id="performance-improvements">14.2 Performance Improvements</h3>
<ul class="task-list">
<li><label><input type="checkbox" />Redis caching for frequent
queries</label></li>
<li><label><input type="checkbox" />CDN for static assets</label></li>
<li><label><input type="checkbox" />Database read replicas</label></li>
<li><label><input type="checkbox" />API rate limiting</label></li>
<li><label><input type="checkbox" />Response compression</label></li>
</ul>
<hr />
<h2 id="conclusion">15. Conclusion</h2>
<h3 id="project-achievements">15.1 Project Achievements</h3>
<p>âœ… <strong>Production-Ready API</strong> with 30+ endpoints<br />
âœ… <strong>Advanced AI/ML Integration</strong> (3 AI features)<br />
âœ… <strong>Enterprise Security</strong> (JWT, RBAC, SQL
validation)<br />
âœ… <strong>Scalable Architecture</strong> (async, cursor
pagination)<br />
âœ… <strong>Comprehensive Testing</strong> (unit + integration)<br />
âœ… <strong>Docker Deployment</strong> (containerized +
orchestrated)<br />
âœ… <strong>Full Documentation</strong> (Swagger + ReDoc)</p>
<h3 id="technology-highlights">15.2 Technology Highlights</h3>
<ul>
<li><strong>Modern Stack:</strong> FastAPI + PostgreSQL + AI</li>
<li><strong>Async/Await:</strong> High-performance I/O</li>
<li><strong>RAG System:</strong> State-of-the-art document Q&amp;A</li>
<li><strong>Natural Language:</strong> AI-powered search</li>
<li><strong>Security-First:</strong> 11-layer SQL validation</li>
</ul>
<h3 id="business-value">15.3 Business Value</h3>
<ul>
<li>Streamlined library management</li>
<li>Enhanced user experience with AI</li>
<li>Scalable to large book catalogs</li>
<li>Extensible for future features</li>
<li>Production-ready deployment</li>
</ul>
<hr />
<h2 id="appendix-a-quick-start-commands">Appendix A: Quick Start
Commands</h2>
<div class="sourceCode" id="cb41"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Setup</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="ex">poetry</span> install</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cp</span> .env.example .env</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="ex">createdb</span> book_management_db</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="ex">poetry</span> run alembic upgrade head</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Run</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="ex">poetry</span> run uvicorn main:app <span class="at">--reload</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Test</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a><span class="ex">poetry</span> run pytest</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Docker</span></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a><span class="ex">docker-compose</span> up <span class="at">-d</span></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a><span class="ex">docker-compose</span> exec api poetry run alembic upgrade head</span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Access</span></span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a><span class="ex">curl</span> http://localhost:8000/docs</span></code></pre></div>
<hr />
<h2 id="appendix-b-contact-support">Appendix B: Contact &amp;
Support</h2>
<p><strong>Repository:</strong>
https://github.com/hiren0158/book-management-api<br />
<strong>Documentation:</strong> http://localhost:8000/docs<br />
<strong>Issues:</strong> GitHub Issues</p>
<hr />
<p><strong>Report Generated:</strong> December 5, 2025<br />
<strong>Version:</strong> 1.0.0<br />
<strong>Status:</strong> Production Ready âœ…</p>
</body>
</html>
